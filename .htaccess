# AiNA Works .htaccess Configuration

# 1. 基本設定
Options -Indexes
Options -MultiViews
DirectoryIndex index.php

<IfModule mod_rewrite.c>
    RewriteEngine On
    
    # 必要に応じてベースパスを指定
    RewriteBase /aina-works/

    # 2. 直接アクセス禁止（セキュリティ）
    RewriteRule ^(includes|config|sql|vendor)/ - [F,L]

    # 3. /works を /work に正規化
    RewriteCond %{REQUEST_METHOD} GET
    RewriteCond %{THE_REQUEST} \s/+(works)(/|\s|\?) [NC]
    RewriteRule ^works/?$ work/ [R=301,L]

    # 4. xxx/index.php を xxx/ にリダイレクト（SEO）
    RewriteCond %{REQUEST_METHOD} GET
    RewriteCond %{THE_REQUEST} \s/+(.*?/)?index\.php[\s?] [NC]
    RewriteRule ^((?!(api/|assets/|uploads/|storage/)).*?)index\.php$ $1 [R=301,L]

    # 5. .php 拡張子を URL から取り除く (外部リダイレクト)
    # ユーザーが .php 付きでアクセスした場合、拡張子なしにリダイレクト
    RewriteCond %{REQUEST_METHOD} GET
    RewriteCond %{THE_REQUEST} \s[^\s]*\.php [NC]
    RewriteRule ^((?!(api/|assets/|uploads/|storage/)).+)\.php$ $1 [R=301,L,QSA]

    # 6. すでに存在するファイルやディレクトリはそのまま配信
    RewriteCond %{REQUEST_FILENAME} -f [OR]
    RewriteCond %{REQUEST_FILENAME} -d
    RewriteRule ^ - [L]

    # 7. /work を /works.php に内部リライト
    RewriteRule ^work/?$ works.php [L,QSA]

    # 8. 拡張子なしのアクセスを .php に解決する (内部リライト)
    # 既存のディレクトリでなく、.php をつければファイルが存在する場合に適用
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_FILENAME}.php -f
    RewriteRule ^(.+?)/?$ $1.php [L,QSA]

</IfModule>

# 9. エラーページ設定
# サブディレクトリ名に合わせて修正
ErrorDocument 404 /aina-works/404.php
ErrorDocument 403 /aina-works/404.php
ErrorDocument 500 /aina-works/404.php
